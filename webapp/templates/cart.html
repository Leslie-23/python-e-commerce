{% extends "layout.html" %} 
{% block content %}

<section class="py-5">
  <div class="container">
    <!-- Page Header -->
    <div class="text-center mb-5">
      <h1 class="display-4 fw-bold text-gradient mb-3">
        <i class="fas fa-shopping-cart me-3"></i>Shopping Cart
      </h1>
      {% if signedin %}
      <p class="lead text-muted">Welcome back, <span class="fw-semibold text-primary">{{username}}</span>!</p>
      {% else %}
      <p class="lead text-muted">You're shopping as a guest</p>
      {% endif %}
      <div class="divider mx-auto"></div>
    </div>

    {% if (signedin and cart) or (not signedin and guest_cart) %}
    <!-- Cart Items -->
    <div class="row">
      <div class="col-lg-8">
        <div class="card border-0 shadow-sm mb-4">
          <div class="card-header bg-gradient text-white">
            <h5 class="mb-0"><i class="fas fa-list me-2"></i>Cart Items</h5>
          </div>
          <div class="card-body p-0">
            <div class="table-responsive">
              <table class="table table-hover mb-0">
                <thead class="table-dark">
                  <tr>
                    <th class="border-0">Product</th>
                    <th class="border-0">Image</th>
                    <th class="border-0 text-center">Quantity</th>
                    <th class="border-0 text-end">Price</th>
                  </tr>
                </thead>
                <tbody>
                  {% if signedin %}
                    {% for item in cart %}
                    <tr class="cart-item">
                      <td class="align-middle">
                        <div class="d-flex flex-column">
                          <h6 class="mb-1 fw-semibold">{{ item[4] }}</h6>
                          <small class="text-muted">{{ item[1] }}</small>
                        </div>
                      </td>
                      <td class="align-middle">
                        <img src="/static/{{ item[3] }}" 
                             alt="Product Image" 
                             class="rounded-circle shadow-sm"
                             style="width: 50px; height: 50px; object-fit: cover;">
                      </td>
                      <td class="align-middle text-center">
                        <span class="badge bg-primary fs-6">{{ item[0] }}</span>
                      </td>
                      <td class="align-middle text-end">
                        <span class="fw-bold text-success">${{ "%.2f"|format(item[2]) }}</span>
                      </td>
                    </tr>
                    {% endfor %}
                  {% else %}
                    {% for item in guest_cart %}
                    <tr class="cart-item">
                      <td class="align-middle">
                        <div class="d-flex flex-column">
                          <h6 class="mb-1 fw-semibold">{{ item[0] }}</h6>
                          <small class="text-muted">{{ item[1] }}</small>
                        </div>
                      </td>
                      <td class="align-middle">
                        <img src="/static/{{ item[3] }}" 
                             alt="Product Image" 
                             class="rounded-circle shadow-sm"
                             style="width: 50px; height: 50px; object-fit: cover;">
                      </td>
                      <td class="align-middle text-center">
                        <span class="badge bg-primary fs-6">{{ item[4] }}</span>
                      </td>
                      <td class="align-middle text-end">
                        <span class="fw-bold text-success">${{ "%.2f"|format(item[2]) }}</span>
                      </td>
                    </tr>
                    {% endfor %}
                  {% endif %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Cart Summary -->
      <div class="col-lg-4">
        <div class="card border-0 shadow-sm sticky-top">
          <div class="card-header bg-light">
            <h5 class="mb-0"><i class="fas fa-calculator me-2"></i>Order Summary</h5>
          </div>
          <div class="card-body">
            <div class="d-flex justify-content-between mb-3">
              <span>Subtotal:</span>
              <span class="fw-semibold">
                {% set total = 0 %}
                {% if signedin %}
                  {% for item in cart %}
                    {% set total = total + (item[0] * item[2]) %}
                  {% endfor %}
                {% else %}
                  {% for item in guest_cart %}
                    {% set total = total + (item[4] * item[2]) %}
                  {% endfor %}
                {% endif %}
                ${{ "%.2f"|format(total) }}
              </span>
            </div>
            <div class="d-flex justify-content-between mb-3">
              <span>Shipping:</span>
              <span class="text-success fw-semibold">Free</span>
            </div>
            <hr>
            <div class="d-flex justify-content-between mb-4">
              <span class="fw-bold">Total:</span>
              <span class="fw-bold text-primary fs-5">${{ "%.2f"|format(total) }}</span>
            </div>
            
            <!-- Action Buttons -->
            <div class="d-grid gap-2">
              <a href="{{ url_for('checkout') }}" class="btn btn-primary btn-lg">
                <i class="fas fa-credit-card me-2"></i>Proceed to Checkout
              </a>
              <a href="{{ url_for('products') }}" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left me-2"></i>Continue Shopping
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    {% else %}
    <!-- Empty Cart -->
    <div class="text-center py-5">
      <div class="empty-cart-icon mb-4">
        <i class="fas fa-shopping-cart fa-5x text-muted opacity-50"></i>
      </div>
      <h3 class="fw-bold mb-3">Your cart is empty</h3>
      <p class="text-muted mb-4">Looks like you haven't added any items to your cart yet.</p>
      <a href="{{ url_for('products') }}" class="btn btn-primary btn-lg">
        <i class="fas fa-shopping-bag me-2"></i>Start Shopping
      </a>
    </div>
    {% endif %}
  </div>
</section>

<style>
.cart-item {
  transition: all 0.3s ease;
}

.cart-item:hover {
  background-color: rgba(0, 123, 255, 0.05);
  transform: translateX(5px);
}

.empty-cart-icon {
  animation: float 3s ease-in-out infinite;
}

@keyframes float {
  0%, 100% {
    transform: translateY(0px);
  }
  50% {
    transform: translateY(-10px);
  }
}

.sticky-top {
  top: 2rem;
}

.table th {
  font-weight: 600;
  text-transform: uppercase;
  font-size: 0.85rem;
  letter-spacing: 0.5px;
}

.badge {
  padding: 0.5rem;
  border-radius: 50%;
  width: 35px;
  height: 35px;
  display: flex;
  align-items: center;
  justify-content: center;
}
</style>

{% endblock content %}

{% endblock content %}