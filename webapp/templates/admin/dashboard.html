{% extends "admin/layout.html" %}
{% block title %}Admin Dashboard - PAL Store{% endblock %}
{% block breadcrumb %}
    <li class="breadcrumb-item active">Dashboard</li>
{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h1 class="h3 mb-0 text-gray-800">Dashboard Overview</h1>
        <p class="text-muted">Welcome to your admin dashboard. Here's what's happening with your store.</p>
    </div>
</div>

<!-- Stats Cards Row -->
<div class="row mb-4">
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="stats-card">
            <div class="row no-gutters align-items-center">
                <div class="col mr-2">
                    <div class="stats-label mb-1">Total Users</div>
                    <div class="stats-number">{{ stats.total_users or 0 }}</div>
                </div>
                <div class="col-auto">
                    <i class="fas fa-users stats-icon text-primary"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-4">
        <div class="stats-card">
            <div class="row no-gutters align-items-center">
                <div class="col mr-2">
                    <div class="stats-label mb-1">Total Products</div>
                    <div class="stats-number">{{ stats.total_products or 0 }}</div>
                </div>
                <div class="col-auto">
                    <i class="fas fa-box stats-icon text-success"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-4">
        <div class="stats-card">
            <div class="row no-gutters align-items-center">
                <div class="col mr-2">
                    <div class="stats-label mb-1">Total Orders</div>
                    <div class="stats-number">{{ stats.total_orders or 0 }}</div>
                </div>
                <div class="col-auto">
                    <i class="fas fa-shopping-cart stats-icon text-info"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-4">
        <div class="stats-card">
            <div class="row no-gutters align-items-center">
                <div class="col mr-2">
                    <div class="stats-label mb-1">Total Revenue</div>
                    <div class="stats-number">${{ "%.2f"|format(stats.total_revenue or 0) }}</div>
                </div>
                <div class="col-auto">
                    <i class="fas fa-dollar-sign stats-icon text-warning"></i>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Quick Actions & Recent Orders Row -->
<div class="row">
    <!-- Quick Actions -->
    <div class="col-lg-4 mb-4">
        <div class="card-custom">
            <div class="card-header">
                <h6 class="m-0 font-weight-bold text-primary">Quick Actions</h6>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="{{ url_for('admin_add_product') }}" class="btn btn-admin-primary">
                        <i class="fas fa-plus me-2"></i>Add Product
                    </a>
                    <a href="{{ url_for('admin_add_category') }}" class="btn btn-outline-primary">
                        <i class="fas fa-tags me-2"></i>Add Category
                    </a>
                    <a href="{{ url_for('admin_inventory') }}" class="btn btn-outline-warning">
                        <i class="fas fa-warehouse me-2"></i>Manage Inventory
                    </a>
                    <a href="{{ url_for('admin_analytics') }}" class="btn btn-outline-info">
                        <i class="fas fa-chart-line me-2"></i>View Analytics
                    </a>
                </div>
            </div>
        </div>

        <!-- Low Stock Alert -->
        {% if stats.low_stock_items > 0 %}
        <div class="card-custom mt-3">
            <div class="card-header bg-warning text-white">
                <h6 class="m-0 font-weight-bold">
                    <i class="fas fa-exclamation-triangle me-2"></i>Low Stock Alert
                </h6>
            </div>
            <div class="card-body">
                <p class="card-text">
                    <strong>{{ stats.low_stock_items }}</strong> items are running low on stock.
                </p>
                <a href="{{ url_for('admin_inventory') }}" class="btn btn-warning btn-sm">
                    Manage Inventory
                </a>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Recent Orders -->
    <div class="col-lg-8 mb-4">
        <div class="card-custom">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h6 class="m-0 font-weight-bold text-primary">Recent Orders</h6>
                <a href="{{ url_for('admin_orders') }}" class="btn btn-sm btn-outline-primary">View All</a>
            </div>
            <div class="card-body">
                {% if recent_orders %}
                <div class="table-responsive">
                    <table class="table table-custom">
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Customer</th>
                                <th>Date</th>
                                <th>Items</th>
                                <th>Total</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for order in recent_orders %}
                            <tr>
                                <td><strong>#{{ order[0] }}</strong></td>
                                <td>{{ order[2] or 'Guest' }}</td>
                                <td>{{ order[1] }}</td>
                                <td>{{ order[3] }}</td>
                                <td>${{ "%.2f"|format(order[4] or 0) }}</td>
                                <td>
                                    <a href="{{ url_for('admin_order_detail', order_id=order[0]) }}" 
                                       class="btn btn-sm btn-outline-primary">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center text-muted py-4">
                    <i class="fas fa-shopping-cart fa-3x mb-3 opacity-25"></i>
                    <p>No recent orders found.</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Analytics Charts Row -->
<div class="row">
    <div class="col-lg-6 mb-4">
        <div class="card-custom">
            <div class="card-header">
                <h6 class="m-0 font-weight-bold text-primary">Sales Overview</h6>
            </div>
            <div class="card-body">
                <canvas id="salesChart" width="100%" height="50"></canvas>
            </div>
        </div>
    </div>

    <div class="col-lg-6 mb-4">
        <div class="card-custom">
            <div class="card-header">
                <h6 class="m-0 font-weight-bold text-primary">Category Distribution</h6>
            </div>
            <div class="card-body">
                <canvas id="categoryChart" width="100%" height="50"></canvas>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Sales Chart
const salesCtx = document.getElementById('salesChart').getContext('2d');
const salesChart = new Chart(salesCtx, {
    type: 'line',
    data: {
        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
        datasets: [{
            label: 'Sales',
            data: [12, 19, 3, 5, 2, 3],
            borderColor: 'rgb(37, 99, 235)',
            backgroundColor: 'rgba(37, 99, 235, 0.1)',
            tension: 0.4
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: {
                display: false
            }
        },
        scales: {
            y: {
                beginAtZero: true
            }
        }
    }
});

// Category Chart
const categoryCtx = document.getElementById('categoryChart').getContext('2d');
const categoryChart = new Chart(categoryCtx, {
    type: 'doughnut',
    data: {
        labels: ['Electronics', 'Toys', 'Books', 'Clothing'],
        datasets: [{
            data: [30, 25, 20, 25],
            backgroundColor: [
                'rgb(37, 99, 235)',
                'rgb(16, 185, 129)',
                'rgb(245, 158, 11)',
                'rgb(239, 68, 68)'
            ]
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: {
                position: 'bottom'
            }
        }
    }
});
</script>
{% endblock %}
